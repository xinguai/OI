第k近点问题――K-D Tree的应用 By strongoier

学习原理参见http://underthehood.blog.51cto.com/2531780/687160。

插入操作通常采用离线插入所有点，删除操作通常采用打标记。

在维数较少的情况下，以二维为例，我们可以加一个优化，即记录这棵子树里的点的最大最小坐标构成的矩形，在是否反向搜索时利用点到矩形的最小距离进行判断。

【例1】HDOJ 4347 The Closest M Points

题目大意：

有N(1 <= N <= 50000)个K(1 <= K <= 5)维空间下的点，给出T(1 <= T <= 10000)组询问，每次询问N个点中距离某个输入的点前M(1 <= M <= 10)近的点。

算法分析：

直接使用K-D Tree完成查询即可，由于是多维无需加优化，时间复杂度O(NlogN + TMN^((K - 1) / K))。

【例2】Tsinsen A1365 森林旅店

题目大意：

平面上有N(1 <= N <= 10^5)个点，给出Q(1 <= Q <= 20000)次操作，每次可以查询已有点中距某个输入的点前P(1 <= P <= 3)近的距离，也可以插入一个点。

要求同时支持曼哈顿距离和欧几里得距离。

算法分析：

由于插入次数不是特别多，我们可以采用暴力插入的方法。

K-D Tree对于曼哈顿距离和欧几里得距离都是可以支持的，优化手段对于曼哈顿距离尤其有效。

随机数据的期望复杂度为O(NlogN + QPlogN)。

【例3】BZOJ 2626 JZPFAR

题目大意：

平面上有N(1 <= N <= 10^5)个点，给出M(1 <= M <= 10^4)次询问，每次询问N个点中距离某个输入的点第K(1 <= K <= 20)远的点的标号，距离相同时取标号小的。

算法分析：

注意到此题求的是第k远点，这就需要我们改造K-D Tree。其实很简单，我们只要将原来的优化手段变为求点到矩形的最大距离即可。

当然要注意，由于距离相等时要比较标号，所以最远距离相等时仍要进入，这也就导致K-D Tree在这道题里的时间复杂度发生了退化，在随机数据下期望复杂度可能是O(NlogN + MKsqrt(N))。
